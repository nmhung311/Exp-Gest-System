<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{event.title}} - Thi·ªáp m·ªùi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/invite.css" />
    
</head>
<body style="--primary-color: {{branding.primary_color}}; --accent-color: {{branding.accent_color}};">
    <div class="container">
        <!-- Header -->
        <div class="header">
            {% if branding.logo_url %}
            <img src="{{branding.logo_url}}" alt="Logo" class="logo">
            {% endif %}
            <h1 class="event-title">{{event.title}}</h1>
            {% if event.subtitle %}
            <p class="event-subtitle">{{event.subtitle}}</p>
            {% endif %}
        </div>
        
        <!-- Content -->
        <div class="content">
            <div class="greeting">
                K√≠nh g·ª≠i {{guest.title}} {{guest.name}},
            </div>
            
            <p>Tr√¢n tr·ªçng k√≠nh m·ªùi Qu√Ω kh√°ch tham d·ª± s·ª± ki·ªán ƒë·∫∑c bi·ªát:</p>
            
            <!-- Event Details -->
            <div class="event-details">
                <div class="detail-row">
                    <span class="detail-icon">üìÖ</span>
                    <div class="detail-text">
                        <strong>Th·ªùi gian:</strong> {{event.date}} {{event.time}}
                    </div>
                </div>
                
                <div class="detail-row">
                    <span class="detail-icon">üìç</span>
                    <div class="detail-text">
                        <strong>ƒê·ªãa ƒëi·ªÉm:</strong> {{event.location}}
                    </div>
                </div>
                
                {% if event.venue_address %}
                <div class="detail-row">
                    <span class="detail-icon">üè¢</span>
                    <div class="detail-text">
                        <strong>ƒê·ªãa ch·ªâ:</strong> {{event.venue_address}}
                        {% if event.venue_map_url %}
                        <br><a href="{{event.venue_map_url}}" target="_blank">Xem b·∫£n ƒë·ªì</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                {% if event.dress_code %}
                <div class="detail-row">
                    <span class="detail-icon">üëî</span>
                    <div class="detail-text">
                        <strong>Trang ph·ª•c:</strong> {{event.dress_code}}
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- Program Outline -->
            {% if event.program_outline %}
            <div class="program-outline">
                <h3>Ch∆∞∆°ng tr√¨nh:</h3>
                <div id="program-content">
                    <!-- Program will be populated by JavaScript -->
                </div>
            </div>
            {% endif %}
            
            <!-- CTA Section -->
            <div class="cta-section">
                <p><strong>Vui l√≤ng ph·∫£n h·ªìi tr∆∞·ªõc {{rsvp.deadline}} ƒë·ªÉ ch√∫ng t√¥i chu·∫©n b·ªã t·ªët nh·∫•t.</strong></p>
                <a href="{{rsvp.accept_url}}" class="cta-button cta-accept">Tham d·ª±</a>
                <a href="{{rsvp.decline_url}}" class="cta-button cta-decline">T·ª´ ch·ªëi</a>
            </div>
            
            <!-- QR Ticket Section -->
            <div class="qr-section">
                <h3>üé´ V√â THAM D·ª∞ C·ª¶A B·∫†N</h3>
                <img src="{{qr.qr_url}}" alt="QR Code" class="qr-code">
                <div class="qr-warning">
                    ‚ö†Ô∏è QUAN TR·ªåNG: M·ªói QR code ch·ªâ s·ª≠ d·ª•ng ƒë∆∞·ª£c 1 l·∫ßn. Kh√¥ng chia s·∫ª QR code n√†y v·ªõi ng∆∞·ªùi kh√°c.
                </div>
            </div>
            
            <!-- ICS Download -->
            <div style="text-align: center; margin: 20px 0;">
                <a href="/events/{{event.id}}/ics" class="ics-link">üìÖ T·∫£i l·ªãch (.ics)</a>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            {% if branding.logo_url %}
            <img src="{{branding.logo_url}}" alt="Logo" class="footer-logo">
            {% endif %}
            <div class="footer-text">
                <strong>{{event.host_org}}</strong><br>
                üìß Li√™n h·ªá: info@exp.com | üåê Website: www.exp.com<br>
                <small>N·∫øu b·∫°n kh√¥ng th·ªÉ tham d·ª±, vui l√≤ng t·ª´ ch·ªëi ƒë·ªÉ ch√∫ng t√¥i c√≥ th·ªÉ m·ªùi kh√°ch kh√°c.</small>
            </div>
        </div>
    </div>
    
    <script>
        // Parse and display program outline
        function displayProgramOutline() {
            const programData = '{{event.program_outline}}';
            const programContainer = document.getElementById('program-content');
            
            if (!programData || programData === 'null' || programData === '') {
                return;
            }
            
            try {
                const program = JSON.parse(programData);
                if (Array.isArray(program) && program.length > 0) {
                    let html = '';
                    program.forEach(item => {
                        if (item.time || item.item) {
                            html += `
                                <div class="program-item">
                                    <div class="program-time">${item.time || ''}</div>
                                    <div class="program-description">${item.item || ''}</div>
                                </div>
                            `;
                        }
                    });
                    programContainer.innerHTML = html;
                }
            } catch (e) {
                console.error('Error parsing program outline:', e);
                // Fallback: try to parse as simple text format
                if (programData.includes(';')) {
                    const items = programData.split(';').filter(item => item.trim());
                    let html = '';
                    items.forEach(item => {
                        const parts = item.split('-');
                        if (parts.length >= 2) {
                            html += `
                                <div class="program-item">
                                    <div class="program-time">${parts[0].trim()}</div>
                                    <div class="program-description">${parts.slice(1).join('-').trim()}</div>
                                </div>
                            `;
                        }
                    });
                    programContainer.innerHTML = html;
                }
            }
        }
        
        // Run when page loads
        document.addEventListener('DOMContentLoaded', displayProgramOutline);
    </script>
</body>
</html>
